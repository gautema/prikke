#!/bin/bash
# Pre-commit hook: compile and test before allowing commit to main
# Install with: git config core.hooksPath .githooks

set -e

BRANCH=$(git rev-parse --abbrev-ref HEAD)

# Only run checks on main branch
if [ "$BRANCH" != "main" ]; then
    exit 0
fi

echo "Running pre-commit checks (main branch)..."

cd app

# Check if there are staged changes in the app directory
if git diff --cached --name-only | grep -q "^app/"; then
    echo "Compiling..."
    mix compile --warnings-as-errors

    echo "Running tests..."
    mix test

    echo "Pre-commit checks passed!"
else
    echo "No app changes staged, skipping checks."
fi
